!function(){function e(e,t){let s=0,i=e.length;for(;s<i;){const n=(s+i)/2|0;t>e[n]?s=n+1:i=n}return s}function t(e,t){let s=0,i=e.length;for(;s<i;){const n=(s+i)/2|0;t<e[n]?i=n:s=n+1}return s}function s(e){let t=function(e,t=0){let s=3735928559^t,i=1103547991^t;for(let t,n=0;n<e.length;n++)t=e.charCodeAt(n),s=Math.imul(s^t,2654435761),i=Math.imul(i^t,1597334677);return s=Math.imul(s^s>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(s^s>>>13,3266489909),4294967296*(2097151&i)+s>>>0}(e,514),s="#";for(let e=0;e<3;e++){s+=("00"+(t>>8*e&255).toString(16)).substr(-2)}return s}function*i(e,t){let s,i,n=e[Symbol.iterator](),a=t[Symbol.iterator]();for(;;){if(s=n.next(),i=a.next(),s.done&&i.done)return;yield s.done?i.value:i.done?s.value:s.value+i.value}}function n(e){return e+"_"+Math.random().toString(36).substr(2,9)}function a(e){return e.match(/\(([^)]*)\)/)[1]}function o(e,t,s){if(e.native.shiftKey){let e=s.chart;const i=t.datasetIndex;e.config.data.datasets.forEach(((t,s)=>e.setDatasetVisibility(s,!1))),e.show(i)}else Chart.defaults.plugins.legend.onClick(e,t,s)}function l(e,t,s){return Object.entries(e).map((([e,i])=>({data:t(i),label:e,pointRadius:5,borderColor:s(e),backgroundColor:s(e)}))).sort(((e,t)=>e.label.localeCompare(t.label)))}const c={options:{elements:{line:{tension:.35}},scales:{x:{title:{display:!0,text:"Packet loss threshold"}},y:{title:{display:!0,text:"Unavailability (lower better)"},ticks:{callback:function(e){return+(100*e).toFixed(6)+"%"}}}},plugins:{legend:{position:"right",onClick:o}}}},r={type_loss:c,type_time:{options:{elements:{line:{tension:.35}},scales:{x:{title:{display:!0,text:"Month"},type:"time",time:{unit:"month",tooltipFormat:"MM/yyyy"}},y:{title:{display:!0,text:"Unavailability (lower better)"},ticks:{callback:function(e){return+(100*e).toFixed(6)+"%"}}}},plugins:{legend:{position:"right",onClick:o}}}},type_single:c};function d(e,t,s){let i=document.createElement("input");i.type="checkbox",i.id=n(e),i.value=e,i.checked=!0,i.addEventListener("change",s);let a=document.createElement("label");a.htmlFor=i.id,a.innerText=e,document.querySelector(t).appendChild(i),document.querySelector(t).appendChild(a)}function h(e){e.forEach((e=>{!function(e,t){let s=document.createElement("option");s.type="checkbox",s.id=n(e),s.value=e,s.innerText=e,document.querySelector(t).appendChild(s)}(e,"#isp_select>select")}))}function p(e,t,s,i){var n,a,o;document.getElementById("min_loss").value=e,document.getElementById("min_loss").min=e,document.getElementById("min_loss").max=t,document.getElementById("min_loss").step=s,document.getElementById("max_loss").value=t,document.getElementById("max_loss").min=e,document.getElementById("max_loss").max=t,document.getElementById("max_loss").step=s,document.getElementById("ploss").min=e,document.getElementById("ploss").max=t,document.getElementById("ploss").step=s,document.getElementById("ploss").value=(n=(e+t)/2,a=s,o=e,Math.ceil((n-o)/a)*a+o),document.getElementById("min_loss").addEventListener("change",i),document.getElementById("max_loss").addEventListener("change",i),document.getElementById("ploss").addEventListener("change",i)}class u{constructor(e,t){this.chart_context=t,this.data_json=e,this.visible_datasets={},this.min_loss=e.percent_loss[0],this.max_loss=e.percent_loss[e.percent_loss.length-1],this.fixed_loss=e.percent_loss[Math.floor(e.percent_loss.length/2)],this.regions=[...new Set(e.data.map((e=>e.region)))],this.isps=[...new Set(e.data.map((e=>e.isp)))],this.read_type_selector(),this.logarithmic=!0,this.technologies=[...new Set(e.data.map((e=>a(e.isp))))],this.shapes=["circle","rect","star","triangle","cross"];let s=this;const i=window.matchMedia("(prefers-color-scheme: dark)");var n,o;this.set_color_scheme(i.matches),i.addListener((e=>{s.set_color_scheme(e.matches),s.chart.update()})),this.chart=new Chart(t,this.prepare_config()),n=this.regions,o=e=>s.region_change(e),n.forEach((e=>{d(e,"#region_select>span",o)})),function(e,t){e.forEach((e=>{d(e,"#service_technology_select>span",t)}))}(this.technologies,(e=>s.technology_toggle(e))),h(this.isps),this.read_isp_selector();const l=(e.percent_loss[1]||e.percent_loss[0])-e.percent_loss[0];p(this.min_loss,this.max_loss,l,(e=>s.loss_bounds_change(e))),document.getElementById("chart_type").addEventListener("change",(e=>s.type_change(e))),document.getElementById("scale_log").addEventListener("change",(e=>s.scale_change(e))),document.getElementById("isp").addEventListener("change",(e=>s.isp_change(e))),document.getElementById("multiple_isp").addEventListener("change",(e=>{const t=document.getElementById("isp");e.target.checked?(t.setAttribute("multiple",""),t.setAttribute("size","3")):(t.removeAttribute("multiple"),t.removeAttribute("size")),s.isp_change(e)})),this.set_control_visibility()}set_color_scheme(e){Chart.defaults.color=e?"#efefef":"#202020",Chart.defaults.borderColor=e?"#888":"#777"}read_type_selector(){const e=document.getElementById("chart_type");this.chart_type=[...e.options].find((e=>e.selected)).id}read_isp_selector(){const e=document.getElementById("isp");this.selected_isps=[...e.options].filter((e=>e.selected)).map((e=>e.value))}set_control_visibility(){function e(e){document.getElementById(e).style.display="block"}function t(e){document.getElementById(e).style.display="none"}switch(this.chart_type){case"type_time":t("bounds_select"),e("pl_select"),e("service_technology_select"),t("isp_select");break;case"type_loss":e("bounds_select"),t("pl_select"),e("service_technology_select"),t("isp_select");break;case"type_single":e("bounds_select"),t("pl_select"),t("service_technology_select"),e("isp_select")}}prepare_config(){let e={options:r[this.chart_type].options,data:this.prepare_data(),type:"line"};return e.options.scales.y.type=this.logarithmic?"logarithmic":"linear",e}prepare_data(){let n;function o(e,t,s){e.datasets.forEach((e=>{const i=t.indexOf(a(e.label));e.pointStyle=s[i%s.length]}))}switch(this.chart_type){case"type_loss":n=function(n,a,o,c){let r={};const d=e(n.percent_loss,o),h=t(n.percent_loss,c);return n.data.forEach((function(e){a.includes(e.region)&&(r[e.isp]={availability:[...i(e.availability.slice(d,h),(r[e.isp]||{}).availability||[])],count:e.count+((r[e.isp]||{}).count||0)})})),{labels:n.percent_loss.map((e=>e+"%")).slice(d,h),datasets:l(r,(e=>e.availability.map((t=>-t/e.count+1))),s)}}(this.data_json,this.regions,this.min_loss,this.max_loss),o(n,this.technologies,this.shapes);break;case"type_time":n=function(e,t,i){let n={};const a=[...new Set(e.data.map((e=>e.date)))].sort();return e.data.forEach((function(s){i.includes(s.region)&&(s.isp in n||(n[s.isp]=[]),n[s.isp][a.indexOf(s.date)]={availability:((n[s.isp][a.indexOf(s.date)]||{}).availability||0)+s.availability[e.percent_loss.indexOf(t)],count:s.count+((n[s.isp][a.indexOf(s.date)]||{}).count||0)})})),{labels:a.map((e=>e+864e5)),datasets:l(n,(e=>e.map((e=>-e.availability/e.count+1))),s)}}(this.data_json,this.fixed_loss,this.regions),o(n,this.technologies,this.shapes);break;case"type_single":n=function(s,n,a,o,c){let r={};const d=e(s.percent_loss,o),h=t(s.percent_loss,c);return s.data.forEach((function(e){if(a.includes(e.region)&&n.includes(e.isp)){const t=new Date(e.date).getFullYear().toString();r[t]={availability:[...i(e.availability.slice(d,h),(r[t]||{}).availability||[])],count:e.count+((r[t]||{}).count||0)}}})),{labels:s.percent_loss.map((e=>e+"%")).slice(d,h),datasets:l(r,(e=>e.availability.map((t=>-t/e.count+1))),(e=>"hsl("+(parseInt(e)*(360/Object.keys(r).length)%360).toString()+",100%,50%)"))}}(this.data_json,this.selected_isps,this.regions,this.min_loss,this.max_loss)}return n}loss_bounds_change(){this.save_visibility(),this.min_loss=parseFloat(document.getElementById("min_loss").value),this.max_loss=parseFloat(document.getElementById("max_loss").value),this.fixed_loss=parseFloat(document.getElementById("ploss").value),this.chart.config.data=this.prepare_data(),this.restore_visibility(),this.chart.update()}region_change(){this.save_visibility(),this.regions=[...document.querySelectorAll("#region_select>span>input[type='checkbox']:checked")].map((e=>e.value)),this.chart.config.data=this.prepare_data(),this.restore_visibility(),this.chart.update()}type_change(){this.save_visibility(),this.read_type_selector(),this.set_control_visibility();const e=this.prepare_config();this.chart.config.options=e.options,this.chart.config.data=e.data,this.restore_visibility(),this.chart.update()}technology_toggle(e){const t=e.target.checked,s=e.target.value;this.chart.config.data.datasets.forEach(((e,i)=>{a(e.label)===s&&this.chart.setDatasetVisibility(i,t)})),this.chart.update()}scale_change(e){this.save_visibility(),this.logarithmic=e.target.checked;const t=this.prepare_config();this.chart.config.options=t.options,this.restore_visibility(),this.chart.update()}isp_change(){this.save_visibility(),this.read_isp_selector(),this.chart.config.data=this.prepare_data(),this.restore_visibility(),this.chart.update()}save_visibility(){this.chart.config.data.datasets.forEach(((e,t)=>{this.visible_datasets[e.label]=!this.chart.getDatasetMeta(t).hidden}))}restore_visibility(){this.chart.config.data.datasets.forEach(((e,t)=>{this.chart.setDatasetVisibility(t,this.visible_datasets[e.label]??!0)}))}}function _(e){const t=JSON.parse(e);void 0!==t?(document.getElementById("data_download").style.display="none",document.getElementById("chart_with_controls").style.display="block",new u(t,document.getElementById("chart").getContext("2d"))):document.querySelector("label[for='download_progress']").innerText="Download failed; please reload."}document.addEventListener("DOMContentLoaded",(function(){document.getElementById("data_download").style.display="block",function(e,t,s,i){let n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e),n.onprogress=e=>{t(e.loaded,e.total)},n.onload=()=>{s(n.response)},n.onerror=()=>{i()},n.send()}("data.json",(function(e,t){document.getElementById("download_progress").value=e/t}),(e=>_(e)),(()=>_(void 0)))}),!1)}();